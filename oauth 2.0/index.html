<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <h1>OAuth 2.0 Demo</h1>
    <button id="login">Login with OAuth 2.0</button>
    <div id="result"></div>
    <script>
      // Replace these values with your own
      const client_id =
        '909fc6e206093ea7f42f02420f3952a978c1f21c.app.widen.com';
      const client_secret = '07d4dafdf795f583c2e89988788d23c5b089abe5';
      const redirect_uri = 'http://localhost:8080';
      // const scope = 'profile email';
      const auth_url = 'https://cloud.widencollective.com/allowaccess';
      const token_url =
        'https://cloud.widencollective.com/api/rest/oauth/token';

      // Get the login button element
      const login = document.getElementById('login');

      // Add a click event listener to the login button
      login.addEventListener('click', function () {
        // Generate a random state parameter
        const state = Math.random().toString(36).substring(7);

        // Store the state in the local storage
        localStorage.setItem('state', state);

        // Construct the authorization request URL
        const url =
          auth_url +
          '?response_type=code&client_id=' +
          client_id +
          '&redirect_uri=' +
          redirect_uri +
          // '&scope=' +
          // scope +
          '&state=' +
          state;

        // Redirect the user to the authorization server
        window.location.href = url;
      });

      // Check if the page was loaded with a code parameter
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');
      const state = urlParams.get('state');

      if (code && state) {
        // Verify that the state matches the one stored in the local storage
        const storedState = localStorage.getItem('state');
        if (state === storedState) {
          // Remove the state from the local storage
          localStorage.removeItem('state');

          // Exchange the code for an access token
          axios
            .post(
              token_url,
              {
                grant_type: 'authorization_code',
                authorization_code: code,
              },
              {
                headers: {
                  Authorization: `Basic ${window.btoa(
                    client_id + ':' + client_secret
                  )}`,
                },
              }
            )
            .then(function (response) {
              // Get the access token from the response
              const access_token = response.data.access_token;

              // Display the access token in the result div
              const result = document.getElementById('result');
              result.innerHTML = 'Access token: ' + access_token;
            })
            .catch(function (error) {
              // Handle error
              console.log(error);
            });
        } else {
          // Handle state mismatch
          alert('Invalid state parameter');
        }
      }
    </script>
  </body>
</html>

<!-- Retrieve collections -->

<!-- curl --include --header "Authorization: Bearer wat_cloud_3e8ff85d6e7bb3e08bb6da161f531090" \
'https://api.widencollective.com/v2/assets/search?collection=b7b5a916-8d6c-41a3-8e3c-e02157294d72&expand=embeds' -->
<!-- curl --include --header "Authorization: Bearer wat_cloud_cb8cdf04559b6c7fe5fd4a1963bc666a" \
'https://api.widencollective.com/v2/assets/search?offset' -->
